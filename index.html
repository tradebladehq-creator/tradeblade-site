<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>TradeBlade ‚Äî Eval Hedge System</title>
<meta content="TradeBlade Hedge System: a simple way to hedge prop firm evaluations with a small live account and real math." name="description"/>
<link href="assets/favicon.png" rel="icon" type="image/png"/>
<link href="styles.css" rel="stylesheet"/>
</head>
<body>
<header class="nav">
<div class="container nav-inner">
<a class="brand" href="#">
<img alt="TradeBlade logo" class="brand-logo" src="assets/tb-logo.png"/>
<span class="brand-wordmark">TRADEBLADE</span>
</a>
<nav class="nav-links"><a href="#hedge">Hedge</a><a href="#math">Math</a><a href="#book">Free Book</a><a href="#pricing">Pricing</a><a href="#faq">FAQ</a></nav>
<a class="btn btn-primary get-access-btn" href="#cta">Get Access</a>
</div>
</header>
<!-- Top-left NinjaTrader Ecosystem badge -->
<section aria-label="NinjaTrader Ecosystem Top" class="container section section-tight">
<div class="ecosystem-top">
<div class="ecosystem-wrap" style="text-align:center;">
<img alt="NinjaTrader¬Æ Ecosystem" class="ecosystem-top-logo" src="assets/NinjaTrader_NTE_OW_RGB-600x100.png" style="max-width:220px;width:100%;height:auto;"/>
</div>
</div>
</section>
<main>

<section class="hero" id="hedge">
<div class="container hero-inner">
<div class="eyebrow"><span class="eyebrow-nt8">NinjaTrader 8</span> eval hedge system.</div>
<h1 class="headline">FAIL THE EVAL.<br/>GET PAID ANYWAY.</h1>
<p class="subhead">Most prop traders fail evaluations. TradeBlade puts a small live hedge behind your eval so a blow‚Äëup isn't a total loss.</p>
<div class="cta-row">
<a class="btn btn-primary get-access-btn" href="#math">See the Math</a>
<a class="btn btn-ghost" href="#cta">Get Access</a>
</div>
<div class="hero-logo-wrap">
<img alt="TradeBlade" class="hero-logo" src="assets/tb-logo.png"/>
</div>
<p class="muted small" style="margin-top:14px;">Simple setup: 1 ES on the eval ¬∑ 1 MES live in the opposite direction ¬∑ built for a ~$1k live account.</p>
</div>
</section>

<section class="hud-demo" id="hud"><div class="container"><div class="card"><img src="https://tb-upload-chart.tradebladehq.workers.dev/" style="width:100%; border-radius:12px;"/></div></div></section>
<section class="engine-showcase" id="math">
<div class="container">
<div class="engine-header">
<div class="engine-badge-large">
<div class="badge-icon">üßÆ</div>
<div class="badge-content">
<div class="badge-label">Real math</div>
<h2 class="badge-title">What happens across eval cycles</h2>
</div>
</div>
<p class="engine-tagline">No vague promises. Plug in your costs, payouts, and hedge size. See the results.</p>
</div>
<div class="card" style="margin-top:18px;">
<div id="hedge-analysis-root"></div>
</div>
</div>
</section>
<section class="features" id="features">
<div class="container">
<h2 class="section-title">Powered By the Engine. Built For Real Trading.</h2>
<p class="section-sub">Every feature is designed for transparency and control‚Äîknow exactly what the robot is doing, when, and why.</p>
<div class="grid3 mt-24">
<div class="card feature reveal"><h3>üéØ Session Key Levels &amp; Interactive Anchors</h3><p>TradeBlade combines automatic and manual key price levels into a single interactive system. You can adjust levels in real time, and TradeBlade instantly updates entries, targets, and risk boundaries. This gives you direct control over how trades are planned and executed without guessing or recalculating by hand.</p></div>
<div class="card feature reveal"><h3>üõ°Ô∏è Entry Mode (Breakout or Mean Reversion)</h3><p>TradeBlade offers two entry modes: Breakout and Mean Reversion. Breakout trades look for price to move through a key level and continue in that direction, while Mean Reversion trades look for price to reject a level and move back toward balance. Each mode follows clear, rule-based logic with hard risk limits enforced at all times.</p></div>
<div class="card feature reveal"><h3>‚è∞ Long/Short Permissions &amp; Time Windows</h3><p>TradeBlade lets you control when and how it trades. You can define trading hours, long or short permissions, and session boundaries so trades only occur during the times that fit your plan. This helps prevent trades outside your intended window and keeps execution consistent, even when the market slows down or becomes unpredictable.</p></div>
<div class="card feature reveal"><h3>üîå 1-Second Heartbeat Publishing</h3><p>TradeBlade updates its internal view of the market every second, so decisions are always based on current information. This helps ensure trades react to real-time price behavior rather than delayed signals, keeping execution aligned with what's actually happening in the market.</p></div>
<div class="card feature reveal"><h3>üéØ Rule-Based Trade Management</h3><p>TradeBlade manages every trade using clear, predefined rules. Once a trade is active, decisions follow your plan instead of emotions. This creates consistent behavior across every trade and helps remove hesitation, second-guessing, and impulse decisions during fast markets.</p></div>
<div class="card feature reveal"><h3>üìà Risk Controls Are Emotional Controls</h3><p>Risk controls help limit losses and prevent overtrading during difficult market conditions. TradeBlade enforces daily loss limits, cooldown periods, and session resets so trading stops when conditions no longer match your plan. These safeguards help protect your account and keep decision-making disciplined under pressure.</p></div>
</div>
</div>
</section>
<section class="arch" id="architecture">
<div class="container">
<h2 class="section-title">Launch architecture</h2>
<p class="section-sub">No tuner at launch. Clear, inspectable flow from the Strategy to the HUD.</p>
<div class="grid4 mt-24">
<div class="card feature reveal"><h3>Strategy</h3><p>Entries/exits with session‚Äëaware window, loss‚Äëlimit lockouts, and 1‚Äësecond publishing.</p></div>
<div class="card feature reveal"><h3>Bus / DTO</h3><p>In‚Äëprocess store with TTL that holds the latest snapshot and per‚Äësession HWM.</p></div>
<div class="card feature reveal"><h3>Publish Shim</h3><p>Lightweight identity shim that normalizes keys and forwards DTOs into the bus.</p></div>
<div class="card feature reveal"><h3>HUD</h3><p>Visualizer reads the bus and renders a crisp, zero‚Äëflicker dashboard on your chart.</p></div>
</div>
</div>
</section>

<section class="section" id="book">
<div class="container">
<div class="engine-header">
<div class="engine-badge-large">
<div class="badge-icon">üìò</div>
<div class="badge-content">
<div class="badge-label">Free e‚Äëbook</div>
<h2 class="badge-title">The Mathematics of Survival</h2>
</div>
</div>
<p class="engine-tagline">A short, blunt guide on why most traders fail ‚Äî and what it takes to survive long enough to find out if you actually have an edge. Includes the Jesse Livermore story and the lesson most people miss.</p>
</div>
<div class="row" style="gap:18px; flex-wrap:wrap; margin-top:18px;">
<div style="flex:0 0 260px; max-width:260px;">
<img alt="The Mathematics of Survival cover" src="assets/ebook-cover.png" style="width:100%; border-radius:14px; border:1px solid var(--soft);"/>
<a class="btn btn-primary wfull" download="" href="assets/TheMathematicsOfSurvival.pdf" style="margin-top:12px;">Download the free PDF</a>
</div>
<div style="flex:1; min-width:260px;">
<div class="card" style="padding:18px;">
<h3 style="margin-top:0;">What‚Äôs inside</h3>
<ul class="muted" style="margin:10px 0 0 18px; line-height:1.6;">
<li>Why ‚Äúknowing‚Äù isn‚Äôt enough ‚Äî the math proves it.</li>
<li>The real enemy is inside the trader: impulse, fear, revenge, and drift.</li>
<li>Jesse Livermore: the man who knew everything‚Ä¶ and still lost the war.</li>
<li>How to ‚Äúbuild the dam‚Äù: hard rules that stop you from bleeding out.</li>
<li>TradeBlade: mechanical execution for humans.</li>
<li>The appendix: the math behind survival.</li>
</ul>
<p class="muted small" style="margin-top:12px;">If you‚Äôve ever said ‚Äúmy strategy works in backtests but not live,‚Äù start here.</p>
</div>
</div>
</div>
</div>
</section>
<section class="pricing" id="pricing">
<div class="container">
<h2 class="section-title">Choose your plan</h2>
<div class="grid3 mt-24">
<div class="card price featured">
<div class="most-popular-badge">Most Popular</div>
<div class="tag">Pro</div>
<div class="price-amt">$69/mo</div>
<p class="muted">For traders who want automated discipline and psychological guardrails, and are comfortable managing their emotional development independently</p>
<ul class="plist">
<li>Full TradeBlade Engine + HUD</li>
<li>Live trading enabled</li>
<li>Risk guardrails</li>
<li>Per-session HWM</li>
<li>AI-only support (no direct messaging)</li>
<li>Email support (72-hour response)</li>
<li>No onboarding calls or human walkthroughs</li>
<li>Tutorial onboarding only</li>
<li>Updates included</li>
</ul>
<a class="btn btn-primary wfull" href="https://buy.stripe.com/5kQ5kCb7e5n4ef72wJgbm00">Choose Pro</a>
</div>
<div class="card price reveal">
<div class="tag">Desk</div>
<div class="price-amt">$199/mo</div>
<p class="muted">For traders who want stronger enforcement, deeper psychological consistency features, and tools that prevent both tilt and overconfidence</p>
<ul class="plist">
<li>Everything in Pro</li>
<li>Email support within 24 hours</li>
<li>Priority AI + human-assisted troubleshooting</li>
<li>Onboarding help</li>
<li>Multi-account viz</li>
<li>Enhanced analytics</li>
</ul>
<a class="btn btn-ghost wfull" href="https://buy.stripe.com/5kQaEW8Z63eW5IBfjvgbm01">Choose Desk</a>
</div>
<div class="card price reveal">
<div class="tag">Elite</div>
<div class="price-amt">$399/mo</div>
<p class="muted">For teams or professionals who require institutional-grade emotional controls, advanced consistency layers, and the highest stability under variance</p>
<ul class="plist">
<li>Everything in Desk</li>
<li>Direct founder access (limited slots)</li>
<li>Scheduled calls &amp; strategy tune-ups</li>
<li>White-glove support</li>
<li>Custom template development</li>
</ul>
<a class="btn btn-ghost wfull" href="https://buy.stripe.com/eVq3cu6QYaHofjb8V7gbm02">Choose Elite</a>
</div>
</div>
</div>
</section>
<section class="faq" id="faq">
<div class="container">
<h2 class="section-title">Quick answers</h2>
<details class="card faq-item"><summary>Does TradeBlade require NinjaTrader 8?</summary>
<p>Yes. The current build targets NinjaTrader 8.</p></details>
<details class="card faq-item"><summary>Is the HUD real‚Äëtime?</summary>
<p>Yes. The strategy publishes 1s heartbeats; the visualizer polls every second with a zero‚Äëflicker LIVE pill.</p></details>
<details class="card faq-item"><summary>How are risk limits enforced?</summary>
<p>Daily halt, trailing/flat loss, and session HWM gates are enforced in‚Äëstrategy and surfaced on the HUD.</p></details>
<details class="card faq-item"><summary>Do you offer trials?</summary>
<p>We'll announce early‚Äëaccess invites soon. Join the list below.</p></details>
</div>
</section>
<section class="cta" id="cta">
<div class="container cta-inner">
<div class="cta-copy">
<h3>Get early access</h3>
<p>Tell us about your setup and we'll send a download and onboarding steps.</p>
<form class="form" id="earlyAccessForm">
<input id="formEmail" name="email" placeholder="Your email" required="" type="email"/>
<input id="formBroker" name="broker" placeholder="Your broker (optional)" type="text"/>
<button class="btn btn-primary" id="formSubmitBtn" type="submit">Join the list</button>
<div id="formMessage" style="display:none; margin-top:8px; font-size:14px;"></div>
<div class="fine">By submitting, you agree to receive product emails. No spam, unsubscribe anytime.</div>
</form>
</div>
<div class="cta-card card">
<div class="row align-center gap">
<img alt="TB" class="mini-logo" src="assets/tb-logo.png"/>
<div>
<div class="muted company">TradeBlade Technologies</div>
<div class="k">Launch Playbook</div>
</div>
</div>
<ul class="plist mt-12">
<li>Vendor packaging for NT8</li>
<li>Visualizer &amp; HUD polish</li>
<li>Prop‚Äëstyle guardrail presets</li>
<li>Docs &amp; quickstart videos</li>
</ul>
</div>
</div>
</section>
</main>
<footer class="footer">
<div class="container row space-between align-center">
<div class="row align-center gap">
<img alt="TradeBlade" class="mini-logo-footer" src="assets/tb-logo.png"/>
<span class="muted">¬© <span id="y"></span> TradeBlade Technologies LLC</span>
</div>
<div class="row gap">
<a class="muted" href="#">Terms</a>
<a class="muted" href="#">Privacy</a>
<a class="muted" href="#">Contact</a>
</div>
</div>
<!-- Partners / Ecosystem -->
<section aria-labelledby="partners-title" class="container section">
<div class="resources-grid">
<div class="partners-col">
<div class="ecosystem-wrap" style="text-align:center;">
<img alt="NinjaTrader¬Æ Ecosystem" class="partner-nt" src="assets/NinjaTrader_NTE_OW_RGB-600x100.png" style="max-width:220px;width:100%;height:auto;"/>
</div>
<div class="partners-center" style="text-align:center;">
<img alt="Kinetick¬Æ Data Feed" class="partner-kinetick" src="assets/kinetick-banner.gif" style="max-width:600px;width:100%;height:auto;"/>
</div>
</div>
</div></section>
<div class="footer-tag">TradeBlade is powered by the Breakthrough Interactive Levels Engine‚Ñ¢.</div></footer>
<script>document.getElementById("y").textContent = new Date().getFullYear();</script>
<section aria-label="Legal" class="container section disclaimer">
<div class="disclaimer-content">
<p>Risk Disclosure: Futures and forex trading contains substantial risk and is not for every investor. An investor could potentially lose all or more than the initial investment. Risk capital is money that can be lost without jeopardizing ones' financial security or lifestyle. Only risk capital should be used for trading and only those with sufficient risk capital should consider trading. Past performance is not necessarily indicative of future results.</p>
<p>Hypothetical Performance Disclosure: Hypothetical performance results have many inherent limitations, some of which are described below. No representation is being made that any account will or is likely to achieve profits or losses similar to those shown; in fact, there are frequently sharp differences between hypothetical performance results and the actual results subsequently achieved by any particular trading program. One of the limitations of hypothetical performance results is that they are generally prepared with the benefit of hindsight. In addition, hypothetical trading does not involve financial risk, and no hypothetical trading record can completely account for the impact of financial risk of actual trading. for example, the ability to withstand losses or to adhere to a particular trading program in spite of trading losses are material points which can also adversely affect actual trading results. There are numerous other factors related to the markets in general or to the implementation of any specific trading program which cannot be fully accounted for in the preparation of hypothetical performance results and all which can adversely affect trading results.</p>
<p>Live Trade Room Disclosure:  This presentation is for educational purposes only and the opinions expressed are those of the presenter only. All trades presented should be considered hypothetical and should not be expected to be replicated in a live trading account.</p>
<p>Testimonial Disclosure: Testimonials appearing on this website may not be representative of other clients or customers and is not a guarantee of future performance or success.</p>
</div>
</section>
<script src="reveal.js"></script>
<script>
// ‚îÄ‚îÄ‚îÄ Early Access Form ‚Üí Worker ‚Üí Kit.com ‚îÄ‚îÄ‚îÄ
document.getElementById('earlyAccessForm').addEventListener('submit', async function(e) {
  e.preventDefault();

  const email = document.getElementById('formEmail').value.trim();
  const broker = document.getElementById('formBroker').value.trim();
  const btn = document.getElementById('formSubmitBtn');
  const msg = document.getElementById('formMessage');

  if (!email) return;

  btn.disabled = true;
  btn.textContent = 'Joining...';
  msg.style.display = 'none';

  try {
    const resp = await fetch('https://tradeblade-license.tradebladehq.workers.dev/api/subscribe', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: email, broker: broker })
    });

    const data = await resp.json();

    if (resp.ok && data.subscribed) {
      msg.style.display = 'block';
      msg.style.color = '#22c55e';
      msg.textContent = "You're on the list! Check your email for next steps.";
      document.getElementById('formEmail').value = '';
      document.getElementById('formBroker').value = '';
      btn.textContent = 'Joined ‚úì';
    } else {
      throw new Error(data.error || 'Subscribe failed');
    }
  } catch (err) {
    msg.style.display = 'block';
    msg.style.color = '#ef4444';
    msg.textContent = 'Something went wrong. Try again or email support@tradebladehq.com';
    btn.disabled = false;
    btn.textContent = 'Join the list';
  }
});
</script>

<script crossorigin="" src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin="" src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script type="text/babel">
import { useState, useMemo } from "react";

const C = {
  bg: "#0c0e14", surface: "#131620", card: "#1a1e2e", cardHi: "#1f2438",
  border: "#272d42", borderHi: "#3a4160",
  text: "#dfe2ec", dim: "#7e8499", faint: "#4e5368",
  blue: "#5b8af5", green: "#34d399", red: "#ef6b6b", amber: "#f0b940",
  purple: "#9f8cf7", cyan: "#38bdf8", orange: "#f59e42",
};

const font = "ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace";
const sansFont = "system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif";

function Section({ title, icon, children, accent = C.blue }) {
  return (
    <div style={{ marginBottom: 28 }}>
      <div style={{
        display: "flex", alignItems: "center", gap: 8, marginBottom: 14,
        borderBottom: `1px solid ${C.border}`, paddingBottom: 8,
      }}>
        <span style={{ fontSize: 16 }}>{icon}</span>
        <span style={{
          fontFamily: sansFont, fontSize: 13, fontWeight: 700,
          color: accent, textTransform: "uppercase", letterSpacing: 1.5,
        }}>{title}</span>
      </div>
      {children}
    </div>
  );
}

function Param({ label, value, onChange, min, max, step = 1, fmt, sub }) {
  const display = fmt ? fmt(value) : value;
  return (
    <div style={{ marginBottom: 14 }}>
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "baseline" }}>
        <span style={{ fontFamily: sansFont, fontSize: 12, color: C.dim }}>{label}</span>
        <span style={{ fontFamily: font, fontSize: 13, color: C.text, fontWeight: 600 }}>{display}</span>
      </div>
      {sub && <div style={{ fontFamily: sansFont, fontSize: 10, color: C.faint, marginTop: 1 }}>{sub}</div>}
      <input type="range" min={min} max={max} step={step} value={value}
        onChange={e => onChange(Number(e.target.value))}
        style={{ width: "100%", accentColor: C.blue, marginTop: 4, height: 4 }} />
    </div>
  );
}

function ScenarioCard({ title, prob, items, net, color, icon }) {
  const positive = net >= 0;
  return (
    <div style={{
      background: C.card, border: `1px solid ${C.border}`, borderRadius: 10,
      borderLeft: `3px solid ${color}`, padding: "16px 18px", marginBottom: 12,
    }}>
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 10 }}>
        <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
          <span style={{ fontSize: 15 }}>{icon}</span>
          <span style={{ fontFamily: sansFont, fontSize: 13, fontWeight: 700, color: C.text }}>{title}</span>
        </div>
        <span style={{
          fontFamily: font, fontSize: 11, color: C.dim,
          background: C.cardHi, padding: "2px 8px", borderRadius: 4,
        }}>P = {(prob * 100).toFixed(0)}%</span>
      </div>
      <div style={{ display: "grid", gap: 3, marginBottom: 10 }}>
        {items.map((item, i) => (
          <div key={i} style={{
            display: "flex", justifyContent: "space-between", alignItems: "center",
            padding: "3px 0", borderBottom: i < items.length - 1 ? `1px solid ${C.border}22` : "none",
          }}>
            <span style={{ fontFamily: sansFont, fontSize: 11, color: C.dim }}>{item.label}</span>
            <span style={{
              fontFamily: font, fontSize: 11, fontWeight: 500,
              color: item.skip ? C.faint : (item.val >= 0 ? C.green : C.red),
            }}>{item.skip ? item.fmt : ((item.val >= 0 ? "+" : "") + (item.fmt || `$${item.val.toFixed(0)}`))}</span>
          </div>
        ))}
      </div>
      <div style={{
        display: "flex", justifyContent: "space-between", alignItems: "center",
        borderTop: `1px solid ${C.border}`, paddingTop: 8,
      }}>
        <span style={{ fontFamily: sansFont, fontSize: 11, fontWeight: 700, color: C.text }}>Scenario Net</span>
        <span style={{
          fontFamily: font, fontSize: 15, fontWeight: 800,
          color: positive ? C.green : C.red,
        }}>{positive ? "+" : ""}${net.toFixed(0)}</span>
      </div>
      <div style={{ marginTop: 6, display: "flex", justifyContent: "space-between" }}>
        <span style={{ fontFamily: sansFont, fontSize: 10, color: C.faint }}>Weighted EV contribution</span>
        <span style={{
          fontFamily: font, fontSize: 11, fontWeight: 600,
          color: (prob * net) >= 0 ? C.green : C.red,
        }}>{(prob * net) >= 0 ? "+" : ""}${(prob * net).toFixed(2)}</span>
      </div>
    </div>
  );
}

function MetricBox({ label, value, sub, color = C.text }) {
  return (
    <div style={{
      background: C.card, border: `1px solid ${C.border}`, borderRadius: 8,
      padding: "12px 14px", textAlign: "center", flex: 1, minWidth: 120,
    }}>
      <div style={{ fontFamily: font, fontSize: 18, fontWeight: 800, color }}>{value}</div>
      <div style={{ fontFamily: sansFont, fontSize: 10, color: C.dim, marginTop: 2 }}>{label}</div>
      {sub && <div style={{ fontFamily: sansFont, fontSize: 9, color: C.faint, marginTop: 2 }}>{sub}</div>}
    </div>
  );
}

export default function HedgeAnalysis() {
  const [passRate, setPassRate] = useState(20);
  const [payoutRate, setPayoutRate] = useState(45);
  const [avgPeakFail, setAvgPeakFail] = useState(500);
  const [friction, setFriction] = useState(35);
  const [evalHedgeContracts, setEvalHedgeContracts] = useState(2);
  const [paHedgeContracts, setPaHedgeContracts] = useState(4);

  const evalCost = 40;
  const paCost = 85;
  const profitTarget = 3000;
  const trailingDD = 2500;
  const safetyNet = trailingDD + 100;
  const payoutAmt = 2000;

  // Each MES = 1/10 of 1 ES, so N MES contracts = N/10 hedge ratio
  const evalHedgeRatio = evalHedgeContracts * 0.1;
  const paHedgeRatio = paHedgeContracts * 0.1;

  // Per-tick values for display
  const evalHedgeTickVal = (evalHedgeContracts * 1.25).toFixed(2);
  const paHedgeTickVal = (paHedgeContracts * 1.25).toFixed(2);

  const r = useMemo(() => {
    const pPass = passRate / 100;
    const pFail = 1 - pPass;
    const pPayGivenPass = payoutRate / 100;
    const pFailPA = 1 - pPayGivenPass;

    const p1 = pFail;
    const p2 = pPass * pFailPA;
    const p3 = pPass * pPayGivenPass;

    // --- Hedge P/L calculations ---

    // EVAL FAIL: prop sim P/L = avgPeakFail - trailingDD (negative)
    const propPLEvalFail = avgPeakFail - trailingDD;
    const hedgeEvalFail = -evalHedgeRatio * propPLEvalFail;

    // EVAL PASS: prop sim P/L = +profitTarget
    const hedgeEvalPass = -evalHedgeRatio * profitTarget;

    // PA FAIL: similar dynamics, PA hedge contract count
    const propPLPAFail = avgPeakFail - trailingDD;
    const hedgePAFail = -paHedgeRatio * propPLPAFail;

    // PA PAYOUT: prop accumulates safetyNet ($2,600) in funded gains
    // The $2k payout comes FROM those gains ‚Äî not additional trading P/L on top
    const propPLPASuccess = safetyNet;
    const hedgePASuccess = -paHedgeRatio * propPLPASuccess;

    // --- Friction scales with contracts per phase ---
    const eFric = friction * evalHedgeContracts;
    const pFric = friction * paHedgeContracts;

    // --- Scenario nets ---
    const net1 = -evalCost + hedgeEvalFail - eFric;
    const net2 = -evalCost - paCost + hedgeEvalPass - eFric + hedgePAFail - pFric;
    const net3 = -evalCost - paCost + hedgeEvalPass - eFric + payoutAmt + hedgePASuccess - pFric;

    // --- No-hedge baseline (unchanged) ---
    const net1_nh = -evalCost;
    const net2_nh = -evalCost - paCost;
    const net3_nh = -evalCost - paCost + payoutAmt;

    const ev = p1 * net1 + p2 * net2 + p3 * net3;
    const evNH = p1 * net1_nh + p2 * net2_nh + p3 * net3_nh;

    const ev2 = p1 * net1 ** 2 + p2 * net2 ** 2 + p3 * net3 ** 2;
    const sd = Math.sqrt(Math.max(0, ev2 - ev ** 2));
    const ev2NH = p1 * net1_nh ** 2 + p2 * net2_nh ** 2 + p3 * net3_nh ** 2;
    const sdNH = Math.sqrt(Math.max(0, ev2NH - evNH ** 2));

    const cyclesHedge = sd > 0 && ev > 0 ? Math.ceil((1.645 * sd / ev) ** 2) : ev > 0 ? 1 : Infinity;
    const cyclesNH = sdNH > 0 && evNH > 0 ? Math.ceil((1.645 * sdNH / evNH) ** 2) : evNH > 0 ? 1 : Infinity;

    return {
      p1, p2, p3, propPLEvalFail, hedgeEvalFail, hedgeEvalPass,
      propPLPAFail, hedgePAFail, propPLPASuccess, hedgePASuccess,
      net1, net2, net3, net1_nh, net2_nh, net3_nh,
      ev, evNH, sd, sdNH, cyclesHedge, cyclesNH,
      hedgeOnlyEV: ev - evNH, safetyNet,
      eFric, pFric,
    };
  }, [passRate, payoutRate, avgPeakFail, friction, evalHedgeContracts, paHedgeContracts]);

  return (
    <div style={{
      background: C.bg, color: C.text, minHeight: "100vh",
      fontFamily: sansFont, padding: "24px 20px", maxWidth: 820, margin: "0 auto",
    }}>
      <div style={{ marginBottom: 24, borderBottom: `1px solid ${C.border}`, paddingBottom: 16 }}>
        <div style={{
          fontFamily: font, fontSize: 11, color: C.blue, letterSpacing: 2,
          textTransform: "uppercase", marginBottom: 4,
        }}>R63 HEDGE EXECUTION ‚Äî EXPECTED VALUE ANALYSIS</div>
        <h1 style={{
          fontFamily: sansFont, fontSize: 22, fontWeight: 800, color: C.text,
          margin: "4px 0 8px",
        }}>TradeBlade Prop/Hedge Cycle Economics</h1>
        <p style={{ fontSize: 12, color: C.dim, margin: 0, lineHeight: 1.5 }}>
          PropPrimary trades 1 ES on Apex 50k eval. LiveHedge mirrors opposite with{" "}
          <span style={{ color: C.cyan, fontWeight: 600 }}>{evalHedgeContracts} MES</span> during eval and{" "}
          <span style={{ color: C.cyan, fontWeight: 600 }}>{paHedgeContracts} MES</span> during PA on a personal account.
          Eval losses are simulated; hedge gains are real ‚Äî this asymmetry is the engine.
        </p>
      </div>

      {/* Fixed Inputs ‚Äî reactive to contract sliders */}
      <Section title="Fixed Inputs" icon="üìã" accent={C.faint}>
        <div style={{
          display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(160px, 1fr))",
          gap: 8, background: C.card, padding: 14, borderRadius: 8, border: `1px solid ${C.border}`,
        }}>
          {[
            ["Eval Cost", `$${evalCost}`],
            ["PA Cost", `$${paCost}/mo`],
            ["Profit Target", `$${profitTarget.toLocaleString()}`],
            ["Trailing DD", `$${trailingDD.toLocaleString()}`],
            ["Safety Net", `$${r.safetyNet.toLocaleString()}`],
            ["Payout Cap", `$${payoutAmt.toLocaleString()}`],
            ["Prop", "1 ES ‚Äî $12.50/tick"],
            ["Eval Hedge", `${evalHedgeContracts} MES ‚Äî $${evalHedgeTickVal}/tick`],
            ["PA Hedge", `${paHedgeContracts} MES ‚Äî $${paHedgeTickVal}/tick`],
            ["Eval Hedge Ratio", `${(evalHedgeRatio * 100).toFixed(0)}% of ES notional`],
            ["PA Hedge Ratio", `${(paHedgeRatio * 100).toFixed(0)}% of ES notional`],
            ["Eval Friction", `$${r.eFric} (${evalHedgeContracts}√ó$${friction})`],
            ["PA Friction", `$${r.pFric} (${paHedgeContracts}√ó$${friction})`],
          ].map(([l, v], i) => (
            <div key={i} style={{ display: "flex", justifyContent: "space-between", gap: 8 }}>
              <span style={{ fontSize: 11, color: C.dim }}>{l}</span>
              <span style={{ fontFamily: font, fontSize: 11, color: C.text, fontWeight: 500, whiteSpace: "nowrap" }}>{v}</span>
            </div>
          ))}
        </div>
      </Section>

      {/* Adjustable Parameters ‚Äî with contract sliders */}
      <Section title="Model Assumptions (Adjustable)" icon="‚öôÔ∏è" accent={C.purple}>
        <div style={{
          background: C.card, padding: 16, borderRadius: 8, border: `1px solid ${C.border}`,
          display: "grid", gridTemplateColumns: "1fr 1fr", gap: "0 24px",
        }}>
          <Param label="P(Pass Eval)" value={passRate} onChange={setPassRate}
            min={1} max={50} fmt={v => `${v}%`}
            sub="Apex first attempt: 15-20% (industry data)" />
          <Param label="P(Payout | Passed Eval)" value={payoutRate} onChange={setPayoutRate}
            min={10} max={80} fmt={v => `${v}%`}
            sub="FPFX 300k-account study: ~45% of funded get payout" />
          <Param label="Avg Peak Before Failure" value={avgPeakFail} onChange={setAvgPeakFail}
            min={0} max={2500} step={50} fmt={v => `$${v.toLocaleString()}`}
            sub="Avg highest balance before trailing DD kills account" />
          <Param label="Base Friction / Contract / Phase" value={friction} onChange={setFriction}
            min={0} max={100} step={5} fmt={v => `$${v}`}
            sub="MES commissions + slippage per contract per phase" />

          {/* Divider */}
          <div style={{ gridColumn: "1 / -1", borderTop: `1px solid ${C.border}`, margin: "6px 0 10px" }} />

          <Param label="Eval Hedge Contracts (MES)" value={evalHedgeContracts} onChange={setEvalHedgeContracts}
            min={1} max={10} fmt={v => `${v} MES`}
            sub={`= ${(evalHedgeContracts*10).toFixed(0)}% of 1 ES ¬∑ $${evalHedgeTickVal}/tick ¬∑ $${(evalHedgeContracts * friction).toFixed(0)} friction`} />
          <Param label="PA Hedge Contracts (MES)" value={paHedgeContracts} onChange={setPaHedgeContracts}
            min={1} max={10} fmt={v => `${v} MES`}
            sub={`= ${(paHedgeContracts*10).toFixed(0)}% of 1 ES ¬∑ $${paHedgeTickVal}/tick ¬∑ $${(paHedgeContracts * friction).toFixed(0)} friction`} />
        </div>
      </Section>

      <Section title="The Sim/Real Asymmetry" icon="üîë" accent={C.amber}>
        <div style={{
          background: C.card, padding: 16, borderRadius: 8, border: `1px solid ${C.border}`,
          fontSize: 12, lineHeight: 1.7, color: C.dim,
        }}>
          <p style={{ margin: "0 0 8px" }}>
            <strong style={{ color: C.text }}>During eval:</strong> Prop P/L is <span style={{ color: C.amber, fontWeight: 600 }}>simulated</span>. You risk only $40.
            But the hedge captures <span style={{ color: C.green, fontWeight: 600 }}>real gains</span> from those sim losses
            at <span style={{ color: C.cyan, fontWeight: 600 }}>{evalHedgeContracts}/10 scale ({(evalHedgeRatio * 100).toFixed(0)}%)</span>.
          </p>
          <p style={{ margin: "0 0 8px" }}>
            <strong style={{ color: C.green }}>When prop fails ({(r.p1 * 100).toFixed(0)}% of cycles):</strong> Prop sim loss ~${Math.abs(r.propPLEvalFail).toLocaleString()}
            {" ‚Üí "} hedge real gain of <span style={{ color: C.green, fontWeight: 700 }}>+${r.hedgeEvalFail.toFixed(0)}</span> ({evalHedgeContracts} MES).
            You paid $40 for the eval but recovered ${r.hedgeEvalFail.toFixed(0)}.
          </p>
          <p style={{ margin: 0 }}>
            <strong style={{ color: C.red }}>When prop passes ({passRate}%):</strong> Prop sim win of $3,000
            {" ‚Üí "} hedge real loss of <span style={{ color: C.red, fontWeight: 700 }}>${r.hedgeEvalPass.toFixed(0)}</span> ({evalHedgeContracts} MES).
            But this unlocks the PA where real payouts live.
          </p>
        </div>
      </Section>

      <Section title="Three Outcome Scenarios" icon="üéØ" accent={C.blue}>
        <ScenarioCard
          title="SCENARIO 1 ‚Äî FAIL EVAL" prob={r.p1} color={C.green} icon="üìâ"
          items={[
            { label: "Eval fee", val: -evalCost },
            { label: `Prop sim P/L (not real money)`, val: r.propPLEvalFail, fmt: `$${r.propPLEvalFail.toLocaleString()} sim`, skip: true },
            { label: `Hedge real gain (${evalHedgeContracts} MES √ó 1/10 of $${Math.abs(r.propPLEvalFail).toLocaleString()})`, val: r.hedgeEvalFail },
            { label: `Hedge friction (${evalHedgeContracts}√ó$${friction})`, val: -r.eFric },
          ]}
          net={r.net1}
        />
        <ScenarioCard
          title="SCENARIO 2 ‚Äî PASS EVAL, FAIL PA" prob={r.p2} color={C.red} icon="üíÄ"
          items={[
            { label: "Eval fee + PA activation", val: -(evalCost + paCost) },
            { label: `Hedge loss during eval (${evalHedgeContracts} MES vs $3k sim target)`, val: r.hedgeEvalPass },
            { label: `Hedge friction ‚Äî eval (${evalHedgeContracts}√ó$${friction})`, val: -r.eFric },
            { label: `Hedge gain during PA (${paHedgeContracts} MES √ó ~$${Math.abs(r.propPLPAFail).toLocaleString()} loss)`, val: r.hedgePAFail },
            { label: `Hedge friction ‚Äî PA (${paHedgeContracts}√ó$${friction})`, val: -r.pFric },
            { label: "Prop PA payout", val: 0 },
          ]}
          net={r.net2}
        />
        <ScenarioCard
          title={`SCENARIO 3 ‚Äî PASS EVAL, $${payoutAmt.toLocaleString()} PAYOUT`} prob={r.p3} color={C.cyan} icon="üí∞"
          items={[
            { label: "Eval fee + PA activation", val: -(evalCost + paCost) },
            { label: `Hedge loss during eval (${evalHedgeContracts} MES vs $3k sim target)`, val: r.hedgeEvalPass },
            { label: `Hedge friction ‚Äî eval (${evalHedgeContracts}√ó$${friction})`, val: -r.eFric },
            { label: `Prop payout received (cash)`, val: payoutAmt },
            { label: `Hedge loss during PA (${paHedgeContracts} MES √ó $${r.propPLPASuccess.toLocaleString()} funded gain)`, val: r.hedgePASuccess },
            { label: `Hedge friction ‚Äî PA (${paHedgeContracts}√ó$${friction})`, val: -r.pFric },
          ]}
          net={r.net3}
        />
        <div style={{
          background: C.cardHi, border: `1px solid ${C.borderHi}`, borderRadius: 8,
          padding: 10, marginTop: 4, fontSize: 10, color: C.dim, lineHeight: 1.5,
        }}>
          <strong style={{ color: C.amber }}>Scenario 3 note:</strong> Prop accumulates +${r.propPLPASuccess.toLocaleString()} funded gain to lock safety net.
          The $2k payout comes from those accumulated gains ‚Äî the hedge only runs against the ${r.propPLPASuccess.toLocaleString()} trading P/L, not payout on top of it.
          Remaining ${(r.safetyNet - payoutAmt).toLocaleString()} stays in PA as buffer above locked floor.
        </div>
      </Section>

      <Section title="Expected Value Per Cycle" icon="üìä" accent={C.green}>
        <div style={{ display: "flex", gap: 10, flexWrap: "wrap", marginBottom: 14 }}>
          <MetricBox label="EV WITH HEDGE" value={`${r.ev >= 0 ? "+" : ""}$${r.ev.toFixed(2)}`}
            color={r.ev >= 0 ? C.green : C.red} sub={`Standard dev: $${r.sd.toFixed(0)}`} />
          <MetricBox label="EV WITHOUT HEDGE" value={`${r.evNH >= 0 ? "+" : ""}$${r.evNH.toFixed(2)}`}
            color={r.evNH >= 0 ? C.green : C.red} sub={`Standard dev: $${r.sdNH.toFixed(0)}`} />
          <MetricBox label="HEDGE VALUE-ADD"
            value={`${r.hedgeOnlyEV >= 0 ? "+" : ""}$${r.hedgeOnlyEV.toFixed(2)}`}
            color={r.hedgeOnlyEV >= 0 ? C.green : C.red} sub="Per cycle EV difference" />
        </div>
        <div style={{ display: "flex", gap: 10, flexWrap: "wrap" }}>
          <MetricBox label="95% PROFIT CONFIDENCE (HEDGE)"
            value={r.cyclesHedge === Infinity ? "N/A" : `${r.cyclesHedge} cycles`}
            color={C.cyan} sub={r.cyclesHedge < Infinity ? `~${r.cyclesHedge} eval attempts needed` : "Negative EV"} />
          <MetricBox label="95% PROFIT CONFIDENCE (NO HEDGE)"
            value={r.cyclesNH === Infinity ? "N/A" : `${r.cyclesNH} cycles`}
            color={C.orange} sub={r.cyclesNH < Infinity ? `~${r.cyclesNH} eval attempts needed` : "Negative EV"} />
          <MetricBox label="VARIANCE REDUCTION"
            value={r.sdNH > 0 ? `${((1 - r.sd / r.sdNH) * 100).toFixed(0)}%` : "N/A"}
            color={C.purple} sub="Lower variance = smoother P&L" />
        </div>
      </Section>

      <Section title="Side-by-Side Comparison" icon="‚öñÔ∏è" accent={C.cyan}>
        <div style={{
          background: C.card, border: `1px solid ${C.border}`, borderRadius: 8,
          overflow: "hidden",
        }}>
          <table style={{ width: "100%", borderCollapse: "collapse", fontFamily: font, fontSize: 11 }}>
            <thead>
              <tr style={{ background: C.cardHi }}>
                <th style={{ textAlign: "left", padding: "8px 12px", color: C.dim, fontWeight: 500, fontFamily: sansFont }}>Scenario</th>
                <th style={{ textAlign: "center", padding: "8px 12px", color: C.dim, fontWeight: 500, fontFamily: sansFont }}>Prob</th>
                <th style={{ textAlign: "right", padding: "8px 12px", color: C.blue, fontWeight: 600, fontFamily: sansFont }}>With Hedge</th>
                <th style={{ textAlign: "right", padding: "8px 12px", color: C.orange, fontWeight: 600, fontFamily: sansFont }}>No Hedge</th>
                <th style={{ textAlign: "right", padding: "8px 12px", color: C.purple, fontWeight: 600, fontFamily: sansFont }}>Delta</th>
              </tr>
            </thead>
            <tbody>
              {[
                ["Fail Eval", r.p1, r.net1, r.net1_nh],
                ["Pass / Fail PA", r.p2, r.net2, r.net2_nh],
                ["Pass / $2k Payout", r.p3, r.net3, r.net3_nh],
              ].map(([name, prob, wh, nh], i) => (
                <tr key={i} style={{ borderTop: `1px solid ${C.border}` }}>
                  <td style={{ padding: "8px 12px", color: C.text, fontFamily: sansFont, fontSize: 12 }}>{name}</td>
                  <td style={{ padding: "8px 12px", textAlign: "center", color: C.dim }}>{(prob * 100).toFixed(0)}%</td>
                  <td style={{ padding: "8px 12px", textAlign: "right", color: wh >= 0 ? C.green : C.red, fontWeight: 600 }}>
                    {wh >= 0 ? "+" : ""}${wh.toFixed(0)}
                  </td>
                  <td style={{ padding: "8px 12px", textAlign: "right", color: nh >= 0 ? C.green : C.red, fontWeight: 600 }}>
                    {nh >= 0 ? "+" : ""}${nh.toFixed(0)}
                  </td>
                  <td style={{ padding: "8px 12px", textAlign: "right", color: (wh - nh) >= 0 ? C.green : C.red }}>
                    {(wh - nh) >= 0 ? "+" : ""}${(wh - nh).toFixed(0)}
                  </td>
                </tr>
              ))}
              <tr style={{ borderTop: `2px solid ${C.borderHi}`, background: C.cardHi }}>
                <td style={{ padding: "10px 12px", color: C.text, fontWeight: 700, fontFamily: sansFont, fontSize: 12 }}>Weighted EV</td>
                <td style={{ padding: "10px 12px", textAlign: "center", color: C.dim, fontFamily: sansFont, fontSize: 11 }}>100%</td>
                <td style={{ padding: "10px 12px", textAlign: "right", color: r.ev >= 0 ? C.green : C.red, fontWeight: 800, fontSize: 13 }}>
                  {r.ev >= 0 ? "+" : ""}${r.ev.toFixed(2)}
                </td>
                <td style={{ padding: "10px 12px", textAlign: "right", color: r.evNH >= 0 ? C.green : C.red, fontWeight: 800, fontSize: 13 }}>
                  {r.evNH >= 0 ? "+" : ""}${r.evNH.toFixed(2)}
                </td>
                <td style={{ padding: "10px 12px", textAlign: "right", color: r.hedgeOnlyEV >= 0 ? C.green : C.red, fontWeight: 800, fontSize: 13 }}>
                  {r.hedgeOnlyEV >= 0 ? "+" : ""}${r.hedgeOnlyEV.toFixed(2)}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </Section>

      <Section title="Strategic Analysis" icon="üß†" accent={C.amber}>
        <div style={{
          background: C.card, border: `1px solid ${C.border}`, borderRadius: 8,
          padding: 16, fontSize: 12, color: C.dim, lineHeight: 1.7,
        }}>
          <p style={{ margin: "0 0 10px" }}>
            <strong style={{ color: C.green }}>The sim/real asymmetry is the edge.</strong> During eval, prop trades sim capital ‚Äî failures cost only $40.
            But the hedge captures real gains from those sim failures. With {evalHedgeContracts} MES during eval ({(evalHedgeRatio * 100).toFixed(0)}% ratio) and a {passRate}% pass rate,
            <strong style={{ color: C.text }}> {(r.p1 * 100).toFixed(0)}% of cycles generate hedge profits averaging +${r.hedgeEvalFail.toFixed(0)}</strong>,
            turning the most common outcome (eval failure) from a -$40 loss into a {r.net1 >= 0 ? `+$${r.net1.toFixed(0)} gain` : `$${r.net1.toFixed(0)} loss`}.
          </p>
          <p style={{ margin: "0 0 10px" }}>
            <strong style={{ color: C.cyan }}>Scaling up in PA:</strong> Switching to {paHedgeContracts} MES during PA ({(paHedgeRatio * 100).toFixed(0)}% ratio) amplifies
            both the recovery on PA failures and the drag on PA successes. The hedge runs against the ${r.propPLPASuccess.toLocaleString()} funded gain needed to lock the safety net ‚Äî
            the $2k payout comes from those gains, not on top of them.
          </p>
          <p style={{ margin: "0 0 10px" }}>
            <strong style={{ color: C.cyan }}>Variance reduction is the real story.</strong> The hedge cuts standard deviation
            from ${r.sdNH.toFixed(0)} to ${r.sd.toFixed(0)} per cycle ({r.sdNH > 0 ? ((1 - r.sd / r.sdNH) * 100).toFixed(0) : 0}% reduction).
            You reach 95% confidence of profitability in <strong style={{ color: C.text }}>{r.cyclesHedge === Infinity ? "N/A" : r.cyclesHedge} cycles</strong> vs {r.cyclesNH === Infinity ? "N/A" : r.cyclesNH} without hedge.
          </p>
          <p style={{ margin: "0 0 10px" }}>
            <strong style={{ color: C.amber }}>The trade-off:</strong> When the prop succeeds, the hedge costs you.
            Scenario 3 nets +${r.net3.toFixed(0)} with hedge vs +${r.net3_nh.toFixed(0)} without ‚Äî ${Math.abs(r.net3 - r.net3_nh).toFixed(0)} less upside.
            But success is rare ({(r.p3 * 100).toFixed(0)}%) and the hedge makes the dominant failure path profitable.
          </p>
          <p style={{ margin: 0 }}>
            <strong style={{ color: C.purple }}>Capital needed:</strong> Hedge account requires ~${(paHedgeContracts * 1500).toLocaleString()}-${(paHedgeContracts * 2500).toLocaleString()}
            {" "}({paHedgeContracts} MES margin + buffer for worst-case drawdown during successful eval+PA cycle).
          </p>
        </div>
      </Section>

      <Section title="R63 Implementation Notes" icon="‚ö°" accent={C.faint}>
        <div style={{
          background: C.card, border: `1px solid ${C.border}`, borderRadius: 8,
          padding: 14, fontSize: 11, color: C.faint, lineHeight: 1.7, fontFamily: font,
        }}>
          <div>PropPrimary publishes HedgeBreach on confirmed entry fill</div>
          <div>LiveHedge enters opposite via limit at prop fill price</div>
          <div>Same SL/TP tick params = hedge exits mirror prop exits inversely</div>
          <div>R63.1 PropLiquidated = deterministic flatten on prop liquidation</div>
          <div>_hedgeLiquidationActed latch blocks entries after prop blows</div>
          <div>Hedge only enters when flat (no grid/scale-in mirroring)</div>
          <div>30s staleness guard on breach signals</div>
          <div style={{ color: C.cyan, marginTop: 6 }}>Contract scaling: {evalHedgeContracts} MES eval ‚Üí {paHedgeContracts} MES PA (configured via Quantity param)</div>
        </div>
      </Section>

      <div style={{
        textAlign: "center", padding: "12px 0", fontSize: 10, color: C.faint,
        borderTop: `1px solid ${C.border}`, marginTop: 8, lineHeight: 1.5,
      }}>
        Eval hedge: {evalHedgeContracts} MES = {(evalHedgeRatio * 100).toFixed(0)}% ratio ¬∑ PA hedge: {paHedgeContracts} MES = {(paHedgeRatio * 100).toFixed(0)}% ratio
        <br />PA hedge runs against ${r.propPLPASuccess.toLocaleString()} funded gain (safety net) ‚Äî $2k payout comes from those gains
        <br />Friction scales per-contract (${friction}/contract/phase) ¬∑ Trailing DD failure P/L estimated as AvgPeak - $2,500
      </div>
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById('hedge-analysis-root'));
root.render(<HedgeAnalysis />);
</script>
</body>
</html>
